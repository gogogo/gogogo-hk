{% extends 'gogogo/transit/base.html' %}
{% load i18n %}

{% block js %}
	{{block.super}}
	<script type="text/javascript">
		var map;
		
		$(document).ready(function(){
			
			height = $('#general_info').height();
		
			$('#map').height(Math.max(height,400));
			
			map = new GMap2(document.getElementById("map"));
			gogogo.mapSetup(map);
			
			var stopManager = new gogogo.StopManager(map);
			
			var endpoint_list = "{{endpoint_list|join:","}}"
			endpoint_list = endpoint_list.split(",");
			for (var i =0 ; i < endpoint_list.length ; i+=2) {
				var point = new GLatLng(endpoint_list[i] , endpoint_list[i+1]);
            	map.addOverlay(new GMarker(point));	
			}
            
            var trip_id_list = "{{trip_id_list|join:","}}";
            trip_id_list = trip_id_list.split(",")
            for (var i in trip_id_list){
            	var trip = new gogogo.Trip(trip_id_list[i]);

				$(trip).one("stopObjectListComplete",function (e){
					var line = e.target.createPolyline();
					map.addOverlay(line);
				});
				
            	trip.query(function(trip){
					trip.queryStops(stopManager);
				});
			}
			
		});
	</script>
{% endblock %}

{% block content %}
<div id="general_info" class="colborder span-8">
{% if user.is_staff %}
<div class="objects-tool">
		<ul class="object-tools" >
    	{% if user.is_authenticated %}
    	<li><a href="{%url gogogo.views.db.add trip_kind%}?parent={{route.id}}">{% trans "Add trip" %}</a></li>
    	{%endif%}
		<li><a href="{%url gogogo.views.db.report.submit route_kind,route.id%}" >Report</a></li>
    	<li><a href="{%url gogogo.views.db.edit route_kind,route.id %}" >Edit</a></li>
    	</ul>
</div>
<p>
{%endif%}
<table>
    <tr>
    	<td>Short Name: </td>
    	<td>{{route.short_name}}</td>
    </tr>
	<tr>
		<td>Name:</td>
    	<td>{{route.long_name}}</a></td>  
	</tr>
    <tr>
        <td>Agency: </td>
        <td><a href="{%url gogogo.views.transit.agency agency.id%}">{{agency.name}}</a></td>
    </tr>
    <tr><td>Type:</td><td>{{route.type}}</td></tr>
    <tr><td>URL:</td><td>{% if route.url %}<a href="{{route.url}}">Link</a>{%endif%}</td></tr>
    <tr>
        <td>Travel: </td>
        <td>{%for trip in trip_list %}
        {{trip.first.name}} =&#62; {{trip.last.name}} ({{trip.headsign}})<br>
        {% endfor%}
        </td>
    </tr>

</table>
</div>

<div class="span-16 last">
	<div id="map" style="width:100%;height:100%"></div>
</div>

<hr class="space"/>

<div class="span-24 last">
	{{route.desc|linebreaks}}
</div>

{% if trip_list %}
<div class="span-24 last">
	<h3 class="alt"> Trips </h3>
</div>

<div class="span-24">
	<table>
		<tr>
			{%for trip in trip_list %}
			<td><a href="{%url gogogo.views.transit.trip agency.id route.id trip.id %}">{{trip.headsign}}</a></td>
			{%endfor %}
		</tr>
		<tr>
			{%for trip in trip_list %}
			<td>
				{%for stop in trip.stop_list %}
				
				<a href="{%url gogogo.views.transit.stop stop.key_name %}">{{stop.name}}</a><br>
				
				{%endfor %}
			</td>
			{%endfor %}
		</tr>

	</table>
</div>
{% endif %}

{% endblock %}
